<h2>Datasets</h2>
<div class="container">
    <% if @datasets.nil? == false && @datasets.length > 0 %>
    <div class="row">
        <h4>Existing Datasets</h4>
        <%if(@datasets.is_a? String)%>
            There was a problem retrieving data sets for this account.
            <p>@datasets</p>
        <%else%>
        <div class="row">
        <div class="col-sm-4">
            <label>Total Datasets:</label>   <%=@datasets.item_total%>
        </div>
        <label>Page Size:</label>
        <%= select_tag("page_size",options_for_select([['10',10],['25',25],['50',50],['100',100]], selected_key=@page_size)) %>
        </div>
        <% @datasets.each do |ds| %>
            <div>
                <%= ds.dataset_name %> <a href="/dataset/detail/<%= URI::encode(ds.dataset_name) %>">View Details</a> <%if ds.timeseries?%> | <a href="/sessions/forecast/<%= URI::encode(ds.dataset_name) %>">Begin Forecast</a>  | <a href="/sessions/impact/<%= URI::encode(ds.dataset_name) %>">Begin Impact Analysis</a> <%end%>| <a href="/sessions/model/<%= URI::encode(ds.dataset_name) %>">Create Model</a> | <a href="/dataset/delete/<%= URI::encode(ds.dataset_name) %>">Delete Dataset</a>
            </div>
        <% end %>
         <table>
         <tr>
            <td>
            <ul class="pager">
            <%if @page > 0 %> 
                <li class="previous">
                    <a href="<%=request.path%>?page_number=<%=@page -1 %>&page_size=<%=@page_size%>"><<</a>
                </li> 
            <%end%> 
            Page:   <%= @page + 1 %> 
            <%if @datasets.item_total > @datasets.page_size * (@page + 1)%> 
                <li class="next">
                    <a href="<%=request.path%>?page_number=<%=@page + 1%>&page_size=<%=@page_size%>">>></a>
                </li> 
            <%end%>
            </ul>
            </td>
        </td>
        <%end%>
    </div>
    <%end%>
</div>
<% content_for :before_body_end do %>
    <script type="text/javascript">
        $(document).ready(function(){
                pageNumber = <%=@page%> + 1;
                totalItems = <%=@datasets.item_total%>;
                $("#page_size").change(function (){
                    pageSize = $("#page_size").val();
                    if(totalItems < pageSize * pageNumber){
                        pageNumber = 0;
                    }
                    document.location = '<%="#{request.path}?page_number="%>' + pageNumber.toString() + '&page_size=' + pageSize.toString();
                });
             });
    </script>
<% end %>